<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Wed Jun 22 22:23:05 2016 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>pp_cubewidget__define.pro (Documentation for pp_lib)</title>

    
    <style type="text/css" media="all">
            /* setup page */
      body { font-family: Helvetica, sans-serif; font-size: 12pt; margin: 0; padding: 0; }
      div.content { padding: 1em; }
      p { line-height: 1.4; }
      td p { padding-bottom: 0.5em; }
      img { border: 0; }
      
      /* link styles */
      a { text-decoration: none; }
      a:link, a:visited { color: #0000FF; }
      a:hover, a:focus { background: yellow; border-bottom: 1emx dotted #303099; }
      
      /* dir-overview styles */
      dt.filename { margin-top: 0.5em; }
      dl.file_listing { margin-left: 1em; }
      
      /* titles */
      h1, h2, h3, h4 { font-weight:normal; color: #871E31; margin-top: 1.5em; }
      h4 { margin-bottom: 0.25em; }
      .center { margin-left: auto; margin-right: auto; }
      .small { font-family: Verdana, Helvetica, sans-serif; font-size: 90%; }
      .smaller { font-family: Verdana, Helvetica, sans-serif; font-size: 80%; }
      .smallest { font-family: Verdana, Helvetica, sans-serif; font-size: 70%; }
      h1.basename { margin-top: 0; margin-bottom: 0; }
      h1.basename span.file-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      h2.directory { font-size: 90%; margin-bottom: 0; }
      h2.routine-name { margin-top: 0; margin-bottom: 0; }
      p.categories { color: #384806; margin-top: 0; }
      span.file_attribute { float: right; color: #384806; margin: 0 0 1em 3em; }
      div#file_comments { margin-top: 1em; }
      
      div.routine-details { border: 1px dotted #C0C0C0; margin-top: 1em; padding: 1em; }
      span.routine-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      div.details dt { color: #871E31; margin-left: 2em; }
      div.details dt span { color: #384806; margin-left: 2em; }
      div.details dd { margin: 0.5em 2em 1em 4em; }
      a.top {
        font-family: Verdana, Helvetica, sans-serif;
        font-size: 8pt;
        font-weight: bold;
        color: #5070ff;
        text-transform: uppercase;
        float: right;
        margin-left: 1em;
      }
      
      /* comments */
      .pre { white-space: pre; }
      
      /* code styles */
      code { font-family: Monaco, "Courier New", Courier, monospace; font-size: 95%; }
      code.listing { white-space: pre; display: block; margin: 0.75em 0 0.75em 0; padding: 0 3em 0 1em; line-height: 1.4em; }
      code.source { white-space: pre; display: block; }
      code.source span.comments { color: #408080; }
      .syntax { margin-top: 1em; margin-left: 1.5em; text-indent: -1.5em; }
      .var { font-style: italic; }
      .argument { } /* white-space: nowrap; does not work in Safari (and sometimes not even in Firefox) */
      
      dl.routine-summary dt { margin-bottom: 0.25em; }
      dl.routine-summary dd { margin-bottom: 0.5em; margin-left: 2em; }
      
      ul.inherited-method-summary { padding-left: 0em; margin-left: 0em; }
      
      /* general styles */
      ul li { list-style-type: none; }
      table { empty-cells: show; }
      thead { color: #871E31; }
      dd { margin-bottom: 0.35em; }
      input, textarea { background: #F3F6ED; border: #E1D6C6 1px solid; padding: 2px 1em 2px 0.5em; }
      input.text { background: #FFFFC0; }
      
      div.note { margin: 1em 2em 1em 2em; background: #EFEFEF; border: 1px #A0A0A0 dotted; padding: 0 1em 0 1em; }
      p.indent { margin-left: 2em; }
      
      /* An attribute table is a vertical list of name-value pairs. */
      table.box {
        background: #EFEFEF;
        border: 1px #A0A0A0 dotted;
        padding-top: 0.75em;
        padding-bottom: 0.75em;
      }
      table.attribute { padding-left: 0.75em; padding-right: 0.75em; }
      table td { vertical-align: top; }
      table.attribute p { margin: 0; }
      table td.name { font-style: normal; padding-right: 1.5em; }
      ul.fieldslist { padding-top: 0; color: #909090; }
      ul.fieldslist li { margin-bottom: 0.25em; }
      span.fieldname { color: #000000; }
      
      dl.attribute dt { color: #990000; }
      
      /* header/navbar styles */
      div.header { padding: 2em 2em 0 2em; background: #9E9D7B; border-bottom: 2px #262626 solid; }
      div.header h1 { color: white; margin:0; font-weight: normal; }
      div.header h2 { color: white; margin-top: 0; margin-bottom: 1em; font-weight: normal; font-style: italic; font-size: 100%; }
      table.navbar { background: #CCC097; margin: 0; padding: 0; border-bottom: 1px #262626 dotted; width: 100%; }
      table.navbar td { padding: 4px 0.5em 3px 0.5em; white-space: nowrap; vertical-align: top; }
      table.navbar td.flexible { width: 100%; text-align: right; padding-right: 1em; white-space: nowrap; }
      table.navbar td.selected { background: #262626; }
      table.navbar td.selected, table.navbar td.selected a { color: white; }
      table.navbar a:hover, table.navbar a:focus { background: inherit; border-bottom: 1px solid #303099; }
      p.localnavbar { text-align: right; margin: 0.2em 1em 0.2em 0.2em; padding: 0; }
      
      /* CSS graphics styles */
      div.box {
        margin-left: 0.25em;
        display: inline-block;
        width: 0.9em;
        height: 0.9em;
        vertical-align: -1px;
      }
      .red { background-color: #A00; }
      .orange { background-color: #F40; }
      .green { background-color: #480; }
      
      /* index styles */
      span.index_type { margin-left: 1em; }
      dl.index_listing dd { margin-bottom: 0.5em; margin-left: 2em; }
      dl.index_listing dd p { margin-top: 0.2em; margin-bottom: 0em; }
      
      /* search styles */
      fieldset { border: #ddd 1px solid; padding: 1em; margin-top: 3em; }
      legend { color: #871E31; font-size: 120%; }
      label { white-space: nowrap; }
      p.description { margin: 2em 2em 1em 2em; }
      form table td.name { vertical-align: middle; }
      
      /* footer styles */
      div.footer { padding: 0.5em 1em 0.5em 1em; background: #EFEFEF; border-top: 1px #A0A0A0 dotted; }
      div.footer table { width: 100%; }
      div.footer td.right { text-align: right; }

    </style>
    <style type="text/css" media="print">
            p.localnavbar { display: none; }
      
      div.header { background: white; }
      div.header h1 { color: black; }
      div.header h2 { color: black; }

    </style>
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="pp_cubewidget__define.pro (Documentation for pp_lib)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">
<a id="pp_cubewidget::init:source"></a>function pp_cubewidget::init,parent,_ref_extra=rex,std=std
compile_opt idl2

self.backplane_mode=2B

<span class="comments">;Initialize the base widget</span>
ret=self->basewidget::init(parent,_strict_extra=rex,column=2,/base_align_left)
self->getproperty,name=basename,geo=geo

<span class="comments">;Create the widgets</span>
coord=obj_new('catcoord',xrange=[0,9],yrange=[9,0])
draw=obj_new('drawwidget',self,xsize=geo.xsize-240,ysize=geo.ysize-20,/motion_events,coord_object=coord,name=basename+'_draw',/button_events)
image=obj_new('scaleimage',bytarr(10,10),xsize=geo.xsize-240,ysize=geo.ysize-20)
draw->add,image,position=0,/use_coords
row2=obj_new('basewidget',self,column=1,/base_align_left)
row2col1=obj_new('basewidget',row2,column=1,/base_align_left,title='Band selection',frame=1)
void=obj_new('labelwidget',row2col1,value='Band selection')
slide=obj_new('sliderwidget',row2col1,minimum=0,maximum=std.bands-1,title='Band',name=basename+'_band',value=self.band,/drag)
band_label=obj_new('labelwidget',row2col1,value=string((*std.wavs)[self.band],format='(F6.4)')+' '+string(181B)+'m')
band_mode=obj_new('droplistwidget',row2col1,value=['Image','Contour','None'],index=self.band_mode,name=basename+'_band_mode',title='Display mode:')
row2col2=obj_new('basewidget',row2,column=1,/base_align_top,title='Backplane selection',frame=1)
void=obj_new('labelwidget',row2col2,value='Backplane selection')
backplane=obj_new('treewidget',row2col2,scr_ysize=90)
for i=0,std.nback-1 do void=obj_new('treewidget',backplane,value=(*std.bnames)[i],uvalue=i,name=basename+'_backplane')
backplane_mode=obj_new('droplistwidget',row2col2,value=['Image','Contour','None'],index=self.backplane_mode,name=basename+'_backplane_mode',title='Display mode:')
row2col3=obj_new('basewidget',row2,column=1,/base_align_left)
button_base=obj_new('basewidget',row2col3,/nonexclusive)
grid=obj_new('buttonwidget',button_base,value='Draw grid',name=basename+'_drawbutton')
grid->setproperty,set_button=self.grid
plot=obj_new('buttonwidget',button_base,value='Plot spectrum',name=basename+'_plotbutton')
plot->setproperty,set_button=self.plot
file_label=obj_new('labelwidget',row2col3,value='No cube selected',/dynamic_resize)
location_label=obj_new('labelwidget',row2col3,value='No cube selected                      ',/dynamic_resize)
geo_label=obj_new('labelwidget',row2col3,value='No cube selected                      ',/dynamic_resize)
export_base=obj_new('basewidget',row2col3,frame=1,column=1,/base_align_left)
void=obj_new('labelwidget',export_base,value='Export cube')
export_cube_name=obj_new('fieldwidget',export_base,title='Export to variable:',name=basename+'_export_name',/cr_events,/column)
export_cube_file=obj_new('buttonwidget',export_base,value='Export to cube file',name=basename+'_export_file')


self.std=ptr_new(std)
self.band_label=band_label
self.image=image
self.file_label=file_label
self.coord=coord
self.location_label=location_label
self.geo_label=geo_label
self.draw=draw
return,ret
end

<a id="pp_cubewidget::cleanup:source"></a>pro pp_cubewidget::cleanup
compile_opt idl2,hidden
if (obj_valid(self.spectrum)) then obj_destroy,self.spectrum
self->basewidget::cleanup
end

<a id="pp_cubewidget::eventhandler:source"></a>pro pp_cubewidget::eventhandler,event
compile_opt idl2,hidden
ename=strlowcase(event.name)
self->getproperty,name=basename
case ename of
  basename+'_band' : begin
    self.band=event.value
    self.band_label->setproperty,value=string((*(*self.std).wavs)[self.band],format='(F6.4)')+' '+string(181B)+'m'
    if obj_valid(self.cube) then begin
      im=reverse(self.cube->getbandbyindex(self.band),2)
      ptr_free,self.band_im
      self.band_im=ptr_new(im)
      if (self.band_mode eq 0) then begin
        immin=min(im,max=immax,/nan)
        self.image->setproperty,image=im,sclmin=immin,sclmax=immax,bottom=immin
      endif
    endif
  end
  basename+'_band_mode' : self.band_mode=event.index
  basename+'_backplane_mode' : self.backplane_mode=event.index
  basename+'_backplane' : begin
    event.id->getproperty,value=val
    self.backplane=val
    if obj_valid(self.cube) then begin
      im=reverse(self.cube->getsuffixbyname(self.backplane),2)
      ptr_free,self.backplane_im
      self.backplane_im=ptr_new(im)
      if (self.backplane_mode eq 0B) then begin
        immin=min(im,max=immax,/nan)
        self.image->setproperty,image=im,sclmin=immin,sclmax=immax,bottom=immin
      endif
    endif
  end
  basename+'_drawbutton' : begin
    self.grid=~self.grid
    event.id->setproperty,set_button=self.grid
  end
  basename+'_draw' : if (obj_valid(self.cube)) then begin
    value=self.image->pixel_to_value(event.x, event.y,inside=inside,xpixel=xpix,ypixel=ypix,xdata=xdata,ydata=ydata)
    self.coord->getproperty,yrange=yr
    x=xpix+1 & y=yr[0]-ypix+1
    val='X: '+string(x,format='(I4)')+' Z: '+string(y,format='(I4)')$
     +' Value: '+string(value,format='(E12.4)')
    self.location_label->setproperty,value=val
<span class="comments">;    val='Lat: '+string((*self.lat)[x-1,y-1],format='(F7.3)')+' Lon:'+string((*self.lon)[x-1,y-1],format='(F8.3)')$</span>
<span class="comments">;     +string(10B)+' Alt: '+string((*self.alt)[x-1,y-1],format='(E11.4)')</span>
     val='Lat: '+string((*self.lat)[x-1,-y],format='(F7.3)')+' Lon:'+string((*self.lon)[x-1,-y],format='(F8.3)')$
     +string(10B)+' Alt: '+string((*self.alt)[x-1,-y],format='(E11.4)')
    self.geo_label->setproperty,value=val
    if (self.plot && ((event.clicks ne 0) || (event.press ne 0))) then begin
      self.cube->getproperty,core=core,struct_backplanes=backplanes
      newdata={cube:self.cube,pixel:{core:reform(core[x-1,y-1,*]),backplanes:backplanes[x-1,y-1]}}
      if (event.press eq 4) then begin
        self.spectrum->getproperty,spectrum_data=olddata,nspec=nspec
        newdata=[olddata,newdata]
      endif
      self.spectrum->setproperty,spectrum_data=newdata
      self.spectrum->plot
      self.draw->setwindow
    endif
  endif
  basename+'_plotbutton' : begin
    if (obj_valid(self.spectrum)) then obj_destroy,self.spectrum else begin
      top=catgettopobject(self)
      top->getproperty,geometry=geo
      self.spectrum=obj_new('pp_spectrumwidget',scr_xsize=800,scr_ysize=300,name='spectrum',xoffset=geo.xoffset,yoffset=4*geo.yoffset+geo.ysize)
    endelse
    self.plot=obj_valid(self.spectrum)
    event.id->setproperty,set_button=self.plot
  end
  basename+'_export_name' : if (obj_valid(self.cube)) then begin
    name=idl_validname(*event.value)
    if (name ne '') then begin
      cube=self.cube
      savetomain,cube,name
    endif
  endif
  basename+'_export_file' : if (obj_valid(self.cube)) then begin
    self.cube->getproperty,file=cubefile
    self->getproperty,id=id
    file=dialog_pickfile(default_extension='.cub',filter=['*.cub','*.CUB','*.QUB','*.qub'],display_name='Export cube to file',$
     /overwrite_prompt,file=cubefile,dialog_parent=id,/write)
    if (file ne '') then self.cube->write,file
  endif
  else:
endcase
self->draw
if (obj_valid(self.cube)) then begin
  if (self.grid) then begin
    lat=self.cube->getsuffixbyname('LAT_0',found=afound)
    lon=self.cube->getsuffixbyname('LON_0',found=ofound)
    if (afound*ofound eq 0) then begin
      lat=self.cube->getsuffixbyname('LATITUDE')
      lon=self.cube->getsuffixbyname('LONGITUDE')
    endif
    lat=reverse(lat,2)
    lon=reverse(lon,2)
    contour,lat,/noerase,color=fsc_color('red'),xstyle=1,ystyle=1,nlevels=21,xmargin=[0,0],ymargin=[0,0]
    contour,lon,/noerase,color=fsc_color('red'),xstyle=1,ystyle=1,nlevels=21,xmargin=[0,0],ymargin=[0,0]
  endif
  if (self.band_mode eq 1B) && ptr_valid(self.band_im) then begin
    szcont=size(*self.band_im,/dimensions)
    xcont=dindgen(szcont[0])-0.5d0
    ycont=dindgen(szcont[1])-0.5d0
    contour,*self.band_im,xcont,ycont,color=fsc_color('blue'),nlevels=21,xstyle=1,ystyle=1,/noerase,$
      xmargin=[0,0],ymargin=[0,0],xrange=[0,szcont[0]-1],yrange=[0,szcont[1]-1]
  endif
  if (self.backplane_mode eq 1B) && ptr_valid(self.backplane_im) then begin
   szcont=size(*self.backplane_im,/dimensions)
   xcont=dindgen(szcont[0])-0.5d0
   ycont=dindgen(szcont[1])-0.5d0
   contour,*self.backplane_im,xcont,ycont,color=fsc_color('green'),nlevels=21,xstyle=1,ystyle=1,/noerase,$
     xmargin=[0,0],ymargin=[0,0],xrange=[0,szcont[0]-1],yrange=[0,szcont[1]-1]
  endif
endif
if (ename eq basename+'_band') && (event.drag ne 1) then begin <span class="comments">;Do not forward drag events</span>
  self->getproperty,parents=par
  par->eventhandler,event
endif
end

<a id="pp_cubewidget::messagehandler:source"></a>pro pp_cubewidget::messagehandler,title,sender=sender,data=data
compile_opt idl2,hidden
self.cube=data
data->getproperty,file=file,lines=lines,samples=samples
self.file_label->setproperty,value='Cube: '+file
ptr_free,self.band_im
ptr_free,self.backplane_im
self.coord->setproperty,yrange=[lines-1,0],xrange=[0,samples-1]
ptr_free,self.lat,self.lon,self.alt
self.lat=ptr_new(reverse(self.cube->getsuffixbyname('LAT_0'),2))
self.lon=ptr_new(reverse(self.cube->getsuffixbyname('LON_0'),2))
self.alt=ptr_new(reverse(self.cube->getsuffixbyname('ALT_0'),2))

end



<a id="pp_cubewidget__define:source"></a>pro pp_cubewidget__define
compile_opt idl2
void={pp_cubewidget,inherits basewidget,band:0L,backplane:'',std:ptr_new(),band_mode:0B,$
 backplane_mode:0B,grid:0B,band_label:obj_new(),image:obj_new(),cube:obj_new(),file_label:obj_new(),$
 band_im:ptr_new(),backplane_im:ptr_new(),coord:obj_new(),location_label:obj_new(),plot:0B,spectrum:obj_new(),draw:obj_new(),$
 lat:ptr_new(),lon:ptr_new(),alt:ptr_new(),geo_label:obj_new()}
end
</code>
    </div>
  </body>
</html>